<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聊天记录</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            color: #000000;
            margin: 0;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
            color: #000000;
        }
        .header .date-range {
            font-size: 14px;
            color: #555555;
        }
        .record {
            display: flex;
            align-items: flex-start;
            padding-bottom: 20px;
            position: relative;
        }
        .record .avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin-right: 10px;
        }
        .record .content {
            flex-grow: 1;
            border-bottom: 0.3px solid #d3d3d3; /* 淡灰色的分隔线 */
            padding-bottom: 10px; /* 分隔线和内容之间的间距 */
        }
        .record .user {
            font-size: 16px;
            color: #333333;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .record .time {
            font-size: 12px;
            color: #777777;
        }
        .record .numbers {
            font-size: 14px;
            line-height: 1.6;
            white-space: nowrap;
            color: #000000;
        }
        .no-avatar .content {
            margin-left: 50px; /* 为了和有头像的消息对齐 */
        }
    </style>
</head>
<body>

<div class="header">
    <h1>你是好人的聊天记录</h1>
    <div class="date-range">2024年8月5日至2024年8月6日</div>
</div>

<div id="records-container"></div>

<script>
    function loadRecords() {
        fetch('/api/records')
            .then(response => response.json())
            .then(records => {
                const container = document.getElementById('records-container');
                container.innerHTML = ''; // 清空容器内容

                let lastUser = ''; // 记录上一个消息的用户名

                records.forEach((record, index) => {
                    const recordDiv = document.createElement('div');
                    recordDiv.className = 'record';

                    // 判断是否显示头像
                    if (record.user !== lastUser) {
                        const avatarImg = document.createElement('img');
                        avatarImg.className = 'avatar';
                        avatarImg.src = record.avatar; // 设置头像图片URL
                        recordDiv.appendChild(avatarImg);
                    } else {
                        recordDiv.classList.add('no-avatar'); // 如果没有头像，添加一个类来处理对齐问题
                    }

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'content';

                    const userDiv = document.createElement('div');
                    userDiv.className = 'user';
                    userDiv.innerHTML = `
                        <span>${record.user}</span>
                        <span class="time">${record.time}</span>
                    `;

                    const numbersDiv = document.createElement('div');
                    numbersDiv.className = 'numbers';
                    numbersDiv.innerText = record.numbers;

                    contentDiv.appendChild(userDiv);
                    contentDiv.appendChild(numbersDiv);

                    recordDiv.appendChild(contentDiv);
                    container.appendChild(recordDiv);

                    // 更新 lastUser 以记录当前的用户名
                    lastUser = record.user;
                });
            });
    }

    // 页面加载完成后加载记录
    document.addEventListener('DOMContentLoaded', loadRecords);
</script>

</body>
</html>
